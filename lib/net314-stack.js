"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cdk = require("@aws-cdk/core");
const ec2 = require("@aws-cdk/aws-ec2");
const aws_iam_1 = require("@aws-cdk/aws-iam");
class Net314Stack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        // IAM
        const role = new aws_iam_1.Role(this, 'InstanceCoreRole', {
            assumedBy: new aws_iam_1.ServicePrincipal('ec2.amazonaws.com')
        });
        role.addManagedPolicy(aws_iam_1.ManagedPolicy.fromAwsManagedPolicyName('AmazonSSMManagedInstanceCore'));
        // Elastic IPs
        const elasticIP = new ec2.CfnEIP(this, 'ElasticIP');
        // VPCs
        const leftVpc = new ec2.Vpc(this, 'LeftVPC', {
            cidr: "10.1.0.0/16",
            maxAzs: 1,
            subnetConfiguration: [
                {
                    cidrMask: 24,
                    name: 'ingressLeftPublic',
                    subnetType: ec2.SubnetType.PUBLIC,
                }
            ]
        });
        const rightVpc = new ec2.Vpc(this, 'RightVPC', {
            cidr: "10.2.0.0/16",
            maxAzs: 1,
            subnetConfiguration: [
                {
                    cidrMask: 24,
                    name: 'ingressRightPublic',
                    subnetType: ec2.SubnetType.PUBLIC,
                }
            ]
        });
        const southVpc = new ec2.Vpc(this, 'SouthVPC', {
            cidr: "10.3.0.0/16",
            maxAzs: 1,
            natGatewayProvider: ec2.NatProvider.instance({
                instanceType: new ec2.InstanceType('t3.micro')
            }),
            subnetConfiguration: [
                {
                    cidrMask: 24,
                    name: 'ingressSouthPublic',
                    subnetType: ec2.SubnetType.PUBLIC,
                },
                {
                    cidrMask: 24,
                    name: 'ingressSouthPrivate',
                    subnetType: ec2.SubnetType.PRIVATE,
                }
            ]
        });
        // EC2
        const leftSg = new ec2.SecurityGroup(this, 'LeftSecurityGroup', {
            securityGroupName: 'LeftSecurityGroup',
            vpc: leftVpc
        });
        leftSg.addIngressRule(ec2.Peer.ipv4("10.0.0.0/8"), ec2.Port.allTraffic(), 'All');
        const rightSg = new ec2.SecurityGroup(this, 'RightSecurityGroup', {
            securityGroupName: 'RightSecurityGroup',
            vpc: rightVpc
        });
        rightSg.addIngressRule(ec2.Peer.ipv4("10.0.0.0/8"), ec2.Port.allTraffic(), 'All');
        const openSwanSg = new ec2.SecurityGroup(this, 'OpenSwanSecurityGroup', {
            securityGroupName: 'OpenSwanSecurityGroup',
            vpc: southVpc
        });
        openSwanSg.addIngressRule(ec2.Peer.ipv4("10.0.0.0/8"), ec2.Port.allTraffic(), 'All');
        openSwanSg.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.udp(500), 'All');
        const southSg = new ec2.SecurityGroup(this, 'SouthSecurityGroup', {
            securityGroupName: 'SouthSecurityGroup',
            vpc: southVpc
        });
        southSg.addIngressRule(ec2.Peer.ipv4("10.0.0.0/8"), ec2.Port.allTraffic(), 'All');
        const amznLinux = new ec2.AmazonLinuxImage({
            generation: ec2.AmazonLinuxGeneration.AMAZON_LINUX,
            edition: ec2.AmazonLinuxEdition.STANDARD,
            virtualization: ec2.AmazonLinuxVirt.HVM,
            storage: ec2.AmazonLinuxStorage.GENERAL_PURPOSE,
        });
        const leftEc2 = new ec2.Instance(this, 'LeftEC2', {
            instanceName: 'Left',
            instanceType: new ec2.InstanceType('t3.micro'),
            machineImage: amznLinux,
            role: role,
            securityGroup: leftSg,
            vpc: leftVpc,
            vpcSubnets: { subnetType: ec2.SubnetType.PUBLIC }
        });
        const rightEc2 = new ec2.Instance(this, 'RightEC2', {
            instanceName: 'Right',
            instanceType: new ec2.InstanceType('t3.micro'),
            machineImage: amznLinux,
            role: role,
            securityGroup: rightSg,
            vpc: rightVpc,
            vpcSubnets: { subnetType: ec2.SubnetType.PUBLIC }
        });
        const openSwanEc2 = new ec2.Instance(this, 'OpenSwanEC2', {
            instanceName: 'OpenSwan',
            instanceType: new ec2.InstanceType('t3.micro'),
            machineImage: amznLinux,
            role: role,
            securityGroup: openSwanSg,
            sourceDestCheck: false,
            vpc: southVpc,
            vpcSubnets: { subnetType: ec2.SubnetType.PUBLIC }
        });
        const southEc2 = new ec2.Instance(this, 'SouthEC2', {
            instanceName: 'Private',
            instanceType: new ec2.InstanceType('t3.micro'),
            machineImage: amznLinux,
            securityGroup: southSg,
            role: role,
            vpc: southVpc,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE }
        });
    }
}
exports.Net314Stack = Net314Stack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmV0MzE0LXN0YWNrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibmV0MzE0LXN0YWNrLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEscUNBQXNDO0FBQ3RDLHdDQUF5QztBQUN6Qyw4Q0FBeUU7QUFFekUsTUFBYSxXQUFZLFNBQVEsR0FBRyxDQUFDLEtBQUs7SUFDeEMsWUFBWSxLQUFvQixFQUFFLEVBQVUsRUFBRSxLQUFzQjtRQUNsRSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUV4QixNQUFNO1FBRU4sTUFBTSxJQUFJLEdBQUcsSUFBSSxjQUFJLENBQUMsSUFBSSxFQUFFLGtCQUFrQixFQUFFO1lBQzlDLFNBQVMsRUFBRSxJQUFJLDBCQUFnQixDQUFDLG1CQUFtQixDQUFDO1NBQ3JELENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyx1QkFBYSxDQUFDLHdCQUF3QixDQUFDLDhCQUE4QixDQUFDLENBQUMsQ0FBQztRQUU5RixjQUFjO1FBRWQsTUFBTSxTQUFTLEdBQUcsSUFBSSxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQztRQUVwRCxPQUFPO1FBRVAsTUFBTSxPQUFPLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxTQUFTLEVBQUU7WUFDM0MsSUFBSSxFQUFFLGFBQWE7WUFDbkIsTUFBTSxFQUFFLENBQUM7WUFDVCxtQkFBbUIsRUFBRTtnQkFDbkI7b0JBQ0UsUUFBUSxFQUFFLEVBQUU7b0JBQ1osSUFBSSxFQUFFLG1CQUFtQjtvQkFDekIsVUFBVSxFQUFFLEdBQUcsQ0FBQyxVQUFVLENBQUMsTUFBTTtpQkFDbEM7YUFDRjtTQUNGLENBQUMsQ0FBQztRQUVILE1BQU0sUUFBUSxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFO1lBQzdDLElBQUksRUFBRSxhQUFhO1lBQ25C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LFlBQVksRUFBRSxTQUFTO1lBQ3ZCLElBQUksRUFBRSxJQUFJO1lBQ1YsYUFBYSxFQUFFLFVBQVU7WUFDekIsZUFBZSxFQUFFLEtBQUs7WUFDdEIsR0FBRyxFQUFFLFFBQVE7WUFDYixVQUFVLEVBQUUsRUFBRSxVQUFVLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUU7U0FDbEQsQ0FBQyxDQUFDO1FBRUgsTUFBTSxRQUFRLEdBQUcsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxVQUFVLEVBQUU7WUFDbEQsWUFBWSxFQUFFLFNBQVM7WUFDdkIsWUFBWSxFQUFFLElBQUksR0FBRyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUM7WUFDOUMsWUFBWSxFQUFFLFNBQVM7WUFDdkIsYUFBYSxFQUFFLE9BQU87WUFDdEIsSUFBSSxFQUFFLElBQUk7WUFDVixHQUFHLEVBQUUsUUFBUTtZQUNiLFVBQVUsRUFBRSxFQUFFLFVBQVUsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRTtTQUNuRCxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUF6SUQsa0NBeUlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNkayA9IHJlcXVpcmUoJ0Bhd3MtY2RrL2NvcmUnKTtcbmltcG9ydCBlYzIgPSByZXF1aXJlKCdAYXdzLWNkay9hd3MtZWMyJyk7XG5pbXBvcnQgeyBNYW5hZ2VkUG9saWN5LCBSb2xlLCBTZXJ2aWNlUHJpbmNpcGFsIH0gZnJvbSAnQGF3cy1jZGsvYXdzLWlhbSc7XG5cbmV4cG9ydCBjbGFzcyBOZXQzMTRTdGFjayBleHRlbmRzIGNkay5TdGFjayB7XG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBjZGsuQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wcz86IGNkay5TdGFja1Byb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkLCBwcm9wcyk7XG5cbiAgICAvLyBJQU1cblxuICAgIGNvbnN0IHJvbGUgPSBuZXcgUm9sZSh0aGlzLCAnSW5zdGFuY2VDb3JlUm9sZScsIHtcbiAgICAgIGFzc3VtZWRCeTogbmV3IFNlcnZpY2VQcmluY2lwYWwoJ2VjMi5hbWF6b25hd3MuY29tJylcbiAgICB9KTtcbiAgICByb2xlLmFkZE1hbmFnZWRQb2xpY3koTWFuYWdlZFBvbGljeS5mcm9tQXdzTWFuYWdlZFBvbGljeU5hbWUoJ0FtYXpvblNTTU1hbmFnZWRJbnN0YW5jZUNvcmUnKSk7XG5cbiAgICAvLyBFbGFzdGljIElQc1xuXG4gICAgY29uc3QgZWxhc3RpY0lQID0gbmV3IGVjMi5DZm5FSVAodGhpcywgJ0VsYXN0aWNJUCcpO1xuXG4gICAgLy8gVlBDc1xuXG4gICAgY29uc3QgbGVmdFZwYyA9IG5ldyBlYzIuVnBjKHRoaXMsICdMZWZ0VlBDJywge1xuICAgICAgY2lkcjogXCIxMC4xLjAuMC8xNlwiLFxuICAgICAgbWF4QXpzOiAxLFxuICAgICAgc3VibmV0Q29uZmlndXJhdGlvbjogW1xuICAgICAgICB7XG4gICAgICAgICAgY2lkck1hc2s6IDI0LFxuICAgICAgICAgIG5hbWU6ICdpbmdyZXNzTGVmdFB1YmxpYycsXG4gICAgICAgICAgc3VibmV0VHlwZTogZWMyLlN1Ym5ldFR5cGUuUFVCTElDLFxuICAgICAgICB9XG4gICAgICBdXG4gICAgfSk7XG5cbiAgICBjb25zdCByaWdodFZwYyA9IG5ldyBlYzIuVnBjKHRoaXMsICdSaWdodFZQQycsIHtcbiAgICAgIGNpZHI6IFwiMTAuMi4wLjAvMTZcIixcbiAgICAgIG1heEF6czogMSxcbiAgICAgIHN1Ym5ldENvbmZpZ3VyYXRpb246IFtcbiAgICAgICAge1xuICAgICAgICAgIGNpZHJNYXNrOiAyNCxcbiAgICAgICAgICBuYW1lOiAnaW5ncmVzc1JpZ2h0UHVibGljJyxcbiAgICAgICAgICBzdWJuZXRUeXBlOiBlYzIuU3VibmV0VHlwZS5QVUJMSUMsXG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9KTtcblxuICAgIGNvbnN0IHNvdXRoVnBjID0gbmV3IGVjMi5WcGModGhpcywgJ1NvdXRoVlBDJywge1xuICAgICAgY2lkcjogXCIxMC4zLjAuMC8xNlwiLFxuICAgICAgbWF4QXpzOiAxLFxuICAgICAgbmF0R2F0ZXdheVByb3ZpZGVyOiBlYzIuTmF0UHJvdmlkZXIuaW5zdGFuY2Uoe1xuICAgICAgICBpbnN0YW5jZVR5cGU6IG5ldyBlYzIuSW5zdGFuY2VUeXBlKCd0My5taWNybycpXG4gICAgICB9KSxcbiAgICAgIHN1Ym5ldENvbmZpZ3VyYXRpb246IFtcbiAgICAgICAge1xuICAgICAgICAgIGNpZHJNYXNrOiAyNCxcbiAgICAgICAgICBuYW1lOiAnaW5ncmVzc1NvdXRoUHVibGljJyxcbiAgICAgICAgICBzdWJuZXRUeXBlOiBlYzIuU3VibmV0VHlwZS5QVUJMSUMsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBjaWRyTWFzazogMjQsXG4gICAgICAgICAgbmFtZTogJ2luZ3Jlc3NTb3V0aFByaXZhdGUnLFxuICAgICAgICAgIHN1Ym5ldFR5cGU6IGVjMi5TdWJuZXRUeXBlLlBSSVZBVEUsXG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9KTtcblxuICAgIC8vIEVDMlxuXG4gICAgY29uc3QgbGVmdFNnID0gbmV3IGVjMi5TZWN1cml0eUdyb3VwKHRoaXMsICdMZWZ0U2VjdXJpdHlHcm91cCcsIHtcbiAgICAgIHNlY3VyaXR5R3JvdXBOYW1lOiAnTGVmdFNlY3VyaXR5R3JvdXAnLFxuICAgICAgdnBjOiBsZWZ0VnBjXG4gICAgfSk7XG4gICAgbGVmdFNnLmFkZEluZ3Jlc3NSdWxlKGVjMi5QZWVyLmlwdjQoXCIxMC4wLjAuMC84XCIpLCBlYzIuUG9ydC5hbGxUcmFmZmljKCksICdBbGwnKTtcblxuICAgIGNvbnN0IHJpZ2h0U2cgPSBuZXcgZWMyLlNlY3VyaXR5R3JvdXAodGhpcywgJ1JpZ2h0U2VjdXJpdHlHcm91cCcsIHtcbiAgICAgIHNlY3VyaXR5R3JvdXBOYW1lOiAnUmlnaHRTZWN1cml0eUdyb3VwJyxcbiAgICAgIHZwYzogcmlnaHRWcGNcbiAgICB9KTtcbiAgICByaWdodFNnLmFkZEluZ3Jlc3NSdWxlKGVjMi5QZWVyLmlwdjQoXCIxMC4wLjAuMC84XCIpLCBlYzIuUG9ydC5hbGxUcmFmZmljKCksICdBbGwnKTtcblxuICAgIGNvbnN0IG9wZW5Td2FuU2cgPSBuZXcgZWMyLlNlY3VyaXR5R3JvdXAodGhpcywgJ09wZW5Td2FuU2VjdXJpdHlHcm91cCcsIHtcbiAgICAgIHNlY3VyaXR5R3JvdXBOYW1lOiAnT3BlblN3YW5TZWN1cml0eUdyb3VwJyxcbiAgICAgIHZwYzogc291dGhWcGNcbiAgICB9KTtcbiAgICBvcGVuU3dhblNnLmFkZEluZ3Jlc3NSdWxlKGVjMi5QZWVyLmlwdjQoXCIxMC4wLjAuMC84XCIpLCBlYzIuUG9ydC5hbGxUcmFmZmljKCksICdBbGwnKTtcbiAgICBvcGVuU3dhblNnLmFkZEluZ3Jlc3NSdWxlKGVjMi5QZWVyLmFueUlwdjQoKSwgZWMyLlBvcnQudWRwKDUwMCksICdBbGwnKTtcblxuICAgIGNvbnN0IHNvdXRoU2cgPSBuZXcgZWMyLlNlY3VyaXR5R3JvdXAodGhpcywgJ1NvdXRoU2VjdXJpdHlHcm91cCcsIHtcbiAgICAgIHNlY3VyaXR5R3JvdXBOYW1lOiAnU291dGhTZWN1cml0eUdyb3VwJyxcbiAgICAgIHZwYzogc291dGhWcGNcbiAgICB9KTtcbiAgICBzb3V0aFNnLmFkZEluZ3Jlc3NSdWxlKGVjMi5QZWVyLmlwdjQoXCIxMC4wLjAuMC84XCIpLCBlYzIuUG9ydC5hbGxUcmFmZmljKCksICdBbGwnKTtcblxuXG4gICAgY29uc3QgYW16bkxpbnV4ID0gbmV3IGVjMi5BbWF6b25MaW51eEltYWdlKHtcbiAgICAgIGdlbmVyYXRpb246IGVjMi5BbWF6b25MaW51eEdlbmVyYXRpb24uQU1BWk9OX0xJTlVYLFxuICAgICAgZWRpdGlvbjogZWMyLkFtYXpvbkxpbnV4RWRpdGlvbi5TVEFOREFSRCxcbiAgICAgIHZpcnR1YWxpemF0aW9uOiBlYzIuQW1hem9uTGludXhWaXJ0LkhWTSxcbiAgICAgIHN0b3JhZ2U6IGVjMi5BbWF6b25MaW51eFN0b3JhZ2UuR0VORVJBTF9QVVJQT1NFLFxuICAgIH0pO1xuXG4gICAgY29uc3QgbGVmdEVjMiA9IG5ldyBlYzIuSW5zdGFuY2UodGhpcywgJ0xlZnRFQzInLCB7XG4gICAgICBpbnN0YW5jZU5hbWU6ICdMZWZ0JyxcbiAgICAgIGluc3RhbmNlVHlwZTogbmV3IGVjMi5JbnN0YW5jZVR5cGUoJ3QzLm1pY3JvJyksXG4gICAgICBtYWNoaW5lSW1hZ2U6IGFtem5MaW51eCxcbiAgICAgIHJvbGU6IHJvbGUsXG4gICAgICBzZWN1cml0eUdyb3VwOiBsZWZ0U2csXG4gICAgICB2cGM6IGxlZnRWcGMsXG4gICAgICB2cGNTdWJuZXRzOiB7IHN1Ym5ldFR5cGU6IGVjMi5TdWJuZXRUeXBlLlBVQkxJQyB9XG4gICAgfSk7XG5cbiAgICBjb25zdCByaWdodEVjMiA9IG5ldyBlYzIuSW5zdGFuY2UodGhpcywgJ1JpZ2h0RUMyJywge1xuICAgICAgaW5zdGFuY2VOYW1lOiAnUmlnaHQnLFxuICAgICAgaW5zdGFuY2VUeXBlOiBuZXcgZWMyLkluc3RhbmNlVHlwZSgndDMubWljcm8nKSxcbiAgICAgIG1hY2hpbmVJbWFnZTogYW16bkxpbnV4LFxuICAgICAgcm9sZTogcm9sZSxcbiAgICAgIHNlY3VyaXR5R3JvdXA6IHJpZ2h0U2csXG4gICAgICB2cGM6IHJpZ2h0VnBjLFxuICAgICAgdnBjU3VibmV0czogeyBzdWJuZXRUeXBlOiBlYzIuU3VibmV0VHlwZS5QVUJMSUMgfVxuICAgIH0pO1xuXG4gICAgY29uc3Qgb3BlblN3YW5FYzIgPSBuZXcgZWMyLkluc3RhbmNlKHRoaXMsICdPcGVuU3dhbkVDMicsIHtcbiAgICAgIGluc3RhbmNlTmFtZTogJ09wZW5Td2FuJyxcbiAgICAgIGluc3RhbmNlVHlwZTogbmV3IGVjMi5JbnN0YW5jZVR5cGUoJ3QzLm1pY3JvJyksXG4gICAgICBtYWNoaW5lSW1hZ2U6IGFtem5MaW51eCxcbiAgICAgIHJvbGU6IHJvbGUsXG4gICAgICBzZWN1cml0eUdyb3VwOiBvcGVuU3dhblNnLFxuICAgICAgc291cmNlRGVzdENoZWNrOiBmYWxzZSxcbiAgICAgIHZwYzogc291dGhWcGMsXG4gICAgICB2cGNTdWJuZXRzOiB7IHN1Ym5ldFR5cGU6IGVjMi5TdWJuZXRUeXBlLlBVQkxJQyB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBzb3V0aEVjMiA9IG5ldyBlYzIuSW5zdGFuY2UodGhpcywgJ1NvdXRoRUMyJywge1xuICAgICAgaW5zdGFuY2VOYW1lOiAnUHJpdmF0ZScsXG4gICAgICBpbnN0YW5jZVR5cGU6IG5ldyBlYzIuSW5zdGFuY2VUeXBlKCd0My5taWNybycpLFxuICAgICAgbWFjaGluZUltYWdlOiBhbXpuTGludXgsXG4gICAgICBzZWN1cml0eUdyb3VwOiBzb3V0aFNnLFxuICAgICAgcm9sZTogcm9sZSxcbiAgICAgIHZwYzogc291dGhWcGMsXG4gICAgICB2cGNTdWJuZXRzOiB7IHN1Ym5ldFR5cGU6IGVjMi5TdWJuZXRUeXBlLlBSSVZBVEUgfVxuICAgIH0pO1xuICB9XG59XG4iXX0=